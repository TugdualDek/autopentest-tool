import os
import importlib

from .base_plugin import BasePlugin


def load_plugins():
    plugins = {}
    plugin_dir = os.path.dirname(__file__)

    for filename in os.listdir(plugin_dir):
        if filename.endswith('.py') and filename != '__init__.py' and filename != 'base_plugin.py':
            module_name = filename[:-3]  # Remove .py extension
            module = importlib.import_module(f'.{module_name}', package='plugins')

            for item_name in dir(module):
                item = getattr(module, item_name)
                if isinstance(item, type) and issubclass(item, BasePlugin) and item is not BasePlugin:
                    plugins[item_name] = item

    return plugins


# Expose the load_plugins function
__all__ = ['load_plugins', 'BasePlugin']